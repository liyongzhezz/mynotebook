## RPM方式安装



### 准备

```shell
# 检查是否存在旧版本mysql：
rpm -qa | grep -i mysql 

# 如果有旧版本就卸载：
rpm -ev [旧的mysql包名] 
```



### 下载RPM包

```shell
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar
tar xvf mysql-5.7.26-1.el7.x86_64.rpm-bundle.tar
```



解压后会有很多RPM包：

- **mysql-community-client**：客户端的安装包；

- **mysql-community-server**：服务端的安装包；
- **mysql-community-devel**：包含开发库文件的安装包；
- **mysql-community-test**：包含测试的安装包；
- **mysql-community-embedded**：嵌入式mysql安装包；



### 安装

```shell
yum install -y perl libaio libaio-devel numactl net-tools
yum localinsetall -y *.rpm
```



### 启动mysql服务

```shell
systemctl start mysqld.service 
```



查看mysql日志，找到类似下面的这一行：

```shell
# /var/log/mysql.log 
[Note] A temporary password is generated for root@localhost: <wqB!ebdk6b4 
```

> mysql第一次运行的时候会初始化一个root用户并设置一个随机密码，这一行可以找到这个密码



### 连接测试

使用上边的密码连接mysql：

```shell
mysql -uroot -p  # 回车后输入上边的密码 <wqB!ebdk6b4 
```

> 能够连接成功说明部署好了



可以通过下面的命令修改root密码并删除测试数据库和匿名用户：

```shell
# 设置root用户密码 
mysqladmin -u root -p'<wqB!ebdk6b4' password Root123?  

# 删除测试数据库和匿名用户 
mysql_secure_installation 
```





## 源码方式安装

### 安装依赖

> 从mysql5.7开始，boost库是必须依赖的



```shell
yum install -y make gcc gcc-c++ cmake bison-devel ncurses ncurses-devel
mkdir /usr/local/boost 
cd /usr/local/boost 
wget http://www.sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz 
tar zxf boost_1_59_0.tar.gz 
```



### 下载安装mysql

```shell
# 安装目录一般放在 /usr/local/ 下，数据目录使用单独的磁盘
mkdir /usr/local/mysql mkdir -p /data/3306/data mkdir -p /data/3306/binlog 
groupadd mysql 
useradd -g mysql mysql 
chown -R mysql:mysql /usr/local/mysql 
chown -R mysql:mysql /data/3306 
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-boost-5.7.26.tar.gz
tar zxf mysql-boost-5.7.26.tar.gz 
cd mysql-5.7.26 

cmake \ 
	-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \    
	-DMYSQL_DATADIR=/data/3306/data \ 
	-DSYSCONFDIR=/data/3306 \ 
	-DWITH_MYISAM_STORAGE_ENGINE=1 \ 
	-DWITH_INNOBASE_STORAGE_ENGINE=1 \ 
	-DWITH_MEMORY_STORAGE_ENGINE=1 \ 
	-DWITH_READLINE=1 \ 
	-DMYSQL_UNIX_ADDR=/data/3306/mysql.sock \ 
	-DMYSQL_TCP_PORT=3306 \ 
	-DENABLED_LOCAL_INFILE=1 \ 
	-DWITH_PARTITION_STORAGE_ENGINE=1 \ 
	-DEXTRA_CHARSETS=all \ 
	-DDEFAULT_CHARSET=utf8mb4 \ 
	-DDEFAULT_COLLATION=utf8mb4_general_ci \ 
	-DWITH_BOOST=/usr/local/boost  
make && make install 
echo "export PATH=$PATH:/usr/local/mysql/bin" >> /etc/profile 
source /etc/profile 
```



- DCMAKE_INSTALL_PREFIX ：安装的根目录；
- DMYSQL_DATADIR：数据目录；
- DSYSCONFDIR：配置文件目录；
- DWITH_MYISAM_STORAGE_ENGINE=1：编译myisam存储引擎，默认的存储引擎，不加也可以；
- DWITH_INNOBASE_STORAGE_ENGINE=1：支持InnoDB存储引擎，这个也是默认安装的；
- DWITH_MEMORY_STORAGE_ENGINE=1： 持MEMORY引擎；
- DWITH_READLINE=1：使用readline功能；
- DMYSQL_UNIX_ADDR：sock文件存放目录；
- DMYSQL_TCP_PORT=3306 ：数据库端口；
- DENABLED_LOCAL_INFILE=1：可以使用load data infile命令从本地导入文件；
- DWITH_PARTITION_STORAGE_ENGINE=1： 安装数据库分区；
- DEXTRA_CHARSETS=all： 支持所有字符集；
- DDEFAULT_CHARSET=utf8mb4：默认字符集；
- DDEFAULT_COLLATION=utf8mb4_general_ci ：默认效验字符集排序规则，要和DDEFAULT_CHARSET一起用；
- DWITH_BOOST=/usr/local/boost：指定boost库位置，从5.7.5开始Boost库是必需的；



```shell
# 初始化mysql
mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/data/3306/data/ 
```



观察初始化输出，找到类似于如下的一行，这个是初始化设置的mysql默认root密码，需要暂时记住。

```2019-06-29T11:32:37.238756Z 1 [Note] A temporary password is generated for root@localhost: &leFGSPpM4sC ```



```shell
# 设置mysql启动文件
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld 
chmod 755 /etc/init.d/mysqld 
```



编辑mysql启动文件`/etc/init.d/mysqld`，修改`basedir`和`datadir`的值为如下内容：

```shell
# /etc/init.d/mysqld  
basedir=/usr/local/mysql/ 
datadir=/data/3306/data/ 
```



修改配置文件`/etc/my.cnf`为如下的内容：

```shell
[mysqld]
basedir=/usr/local/mysql
datadir=/data/3306/data/
socket=/data/3306/mysql.sock
user=mysql
tmpdir=/data/3306/
lower_case_tables_name=1
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

# Settings user and group are ignored when systemd is used.
# If you need to run mysqld under a different user or group,
# customize your systemd unit file for mariadb according to the
# instructions in http://fedoraproject.org/wiki/Systemd

[mysqld_safe]
log-error=/data/3306/data/error.log
pid-file=/data/3306/data/mysql.pid

#
# include all files from the config directory
#
!includedir /etc/my.cnf.d
```



### 启动mysql

```shell
service mysqld start   

netstat -ntlp | grep mysqld 
tcp6       0      0 :::3306                 :::*                    LISTEN      18471/mysqld  
```



### 连接测试

现在就可以使用前面获取到的默认密码登录数据库了，不过也可以使用下面的命令来重新设置密码及删除匿名用户和库：

```shell
# 设置root用户密码 
mysqladmin -u root -p'&leFGSPpM4sC' password Root123?  

# 删除测试数据库和匿名用户 
mysql_secure_installation mysql -uroot -pRoot123? 
```











