[源码安装redis](源码安装redis)

[yum安装redis](yum安装redis)

[Redis常用配置项](Redis常用配置项)

## 源码安装redis

### 编译安装

```shell
yum install -y gcc gcc-c++
wget https://github.com/antirez/redis/archive/5.0.3.tar.gz
tar zxf 5.0.3.tar.gz
cd redis-5.0.3
make PREFIX=/usr/local/redis install
```



### 设置环境变量和系统参数

```shell
echo "PATH=$PATH:/usr/local/redis/bin" >> /etc/profile
source /etc/profile
```



安装后会在`/usr/local/redis`下生成安装目录，安装的命令有如下：

```shell
# /usr/local/redis/bin
redis-benchmark：性能测试工具
redis-check-aof：文件修复工具
redis-check-dump：rbd文件检查工具
redis-cli：客户端命令行工具
redis-server：服务启动命令
```



```shell
sysctl vm.overcommit_memory=1
echo "sysctl vm.overcommit_memory=1" >> /etc/rc.local
```

`vm.overcommit_memory`是控制内存分配策略的参数：

- 1：内核分配所有的物理内存而不管当前内存状态；
- 0：内核检查是否有足够的内存共当前进程使用，没有则会返回错误给进程；
- 2：内核允许分配超过物理内存和交换空间总和的内存；



### 设置配置文件

编辑配置文件`/usr/local/redis/redis.conf`，修改`daemonize`参数为下面的值，让redis在后台运行：

```shell
daemonize yes
```



> 如果没有`redis.conf`，可以拷贝源码包中的配置文件过去



### 启动redis

```shell
redis-server /usr/loca/redis/redis.conf

ps -ef | grep redis
root      10983      1  0 13:57 ?        00:00:00 redis-server 127.0.0.1:6379

netstat -ntlp | grep redis
tcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      10983/redis-server
```



###  连接redis

```shell
redis-cli
127.0.0.1:6379>
```



### 停止redis

```shell
redis-cli shutdonw
```



## yum安装redis

### 安装依赖

```shell
yum install -y epel-release
```



直接yum安装的redis不是最新的版本，如果要安装最新版本需要执行下面的步骤：

```shell
yum install -y http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
yum --enablerepo=remi install redis -y
```



### 安装redis

```shell
yum install -y redis
redis-cli --version
```



### 设置配置文件

修改`/etc/redis.conf`中的`bind`参数为下面的值，开启允许远程登录：

```shell
bind 0.0.0.0
```



### 设置系统参数

```shell
sysctl vm.overcommit_memory=1
echo "sysctl vm.overcommit_memory=1" >> /etc/rc.local
```

`vm.overcommit_memory`是控制内存分配策略的参数：

- 1：内核分配所有的物理内存而不管当前内存状态；
- 0：内核检查是否有足够的内存共当前进程使用，没有则会返回错误给进程；
- 2：内核允许分配超过物理内存和交换空间总和的内存；



### 启动redis

```shell
systemctl start redis
systemctl enable redis
systemctl status redis
```





## Redis常用配置项

### 监听端口、地址

```shell
# 监听地址
bind 127.0.0.1

# 监听端口
port 6379
```



### redis密码

生产环境应该设置redis密码：

```shell
requirepass redispassword
```



### 后台运行

```shell
daemonsize yes
```



### 可创建的db数

```shell
databases 16
```



默认是16，即可创建0~16共17个db



### 持久化文件保存路径

```shell
dir /data/redis/
```



### 性能配置相关

```shell
# 可使用的最大内存，方式redis OOM
maxmemory 500M
```

